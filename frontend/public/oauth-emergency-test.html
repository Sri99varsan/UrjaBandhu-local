<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production OAuth Test - UrjaBandhu</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #0a0a0a;
            color: #fff;
        }
        .test-section {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #1a5f1a; border-left: 4px solid #4caf50; }
        .error { background: #5f1a1a; border-left: 4px solid #f44336; }
        .warning { background: #5f5f1a; border-left: 4px solid #ff9800; }
        .info { background: #1a1a5f; border-left: 4px solid #2196f3; }
        button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 10px 10px 0;
        }
        button:hover { background: #0052a3; }
        button:disabled { background: #666; cursor: not-allowed; }
        pre {
            background: #000;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            border: 1px solid #333;
        }
        .url-box {
            background: #111;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            border: 1px solid #333;
            margin: 10px 0;
        }
        .copy-btn {
            background: #666;
            font-size: 12px;
            padding: 4px 8px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <h1>üö® Production OAuth Emergency Test</h1>
    <p><strong>Current URL:</strong> <span id="current-url"></span></p>
    <p><strong>Environment:</strong> <span id="environment"></span></p>

    <div class="test-section">
        <h2>üìã Required URLs for Configuration</h2>
        <p>Copy these exact URLs to Google OAuth Console and Supabase Dashboard:</p>
        
        <h3>Google OAuth Console - Authorized JavaScript Origins:</h3>
        <div class="url-box">
            <span id="js-origin"></span>
            <button class="copy-btn" onclick="copyToClipboard('js-origin')">Copy</button>
        </div>
        <div class="url-box">
            https://ygjdvufbiobntseveoia.supabase.co
            <button class="copy-btn" onclick="copyToClipboard('supabase-origin')">Copy</button>
        </div>

        <h3>Google OAuth Console - Authorized Redirect URIs:</h3>
        <div class="url-box">
            https://ygjdvufbiobntseveoia.supabase.co/auth/v1/callback
            <button class="copy-btn" onclick="copyToClipboard('supabase-callback')">Copy</button>
        </div>

        <h3>Supabase Dashboard - Site URL:</h3>
        <div class="url-box">
            <span id="site-url"></span>
            <button class="copy-btn" onclick="copyToClipboard('site-url')">Copy</button>
        </div>

        <h3>Supabase Dashboard - Redirect URLs:</h3>
        <div class="url-box">
            <span id="redirect-url"></span>
            <button class="copy-btn" onclick="copyToClipboard('redirect-url')">Copy</button>
        </div>
    </div>

    <div class="test-section">
        <h2>üîß Environment Test</h2>
        <div id="env-status"></div>
        <button onclick="testEnvironment()">Test Environment Variables</button>
    </div>

    <div class="test-section">
        <h2>üåê Supabase Connection Test</h2>
        <div id="supabase-status"></div>
        <button onclick="testSupabase()">Test Supabase Connection</button>
    </div>

    <div class="test-section">
        <h2>üîë OAuth Test</h2>
        <div id="oauth-status"></div>
        <button onclick="testOAuth()">Test Google OAuth</button>
        <button onclick="getOAuthURL()">Get OAuth URL</button>
    </div>

    <div class="test-section">
        <h2>üìä Debug Information</h2>
        <pre id="debug-info"></pre>
        <button onclick="showDebugInfo()">Show Debug Info</button>
    </div>

    <script>
        // Set current URL info
        document.getElementById('current-url').textContent = window.location.origin;
        document.getElementById('environment').textContent = 
            window.location.hostname === 'localhost' ? 'Development' : 'Production';
        
        // Set URLs for configuration
        const origin = window.location.origin;
        document.getElementById('js-origin').textContent = origin;
        document.getElementById('site-url').textContent = origin;
        document.getElementById('redirect-url').textContent = origin + '/auth/callback';

        // Initialize Supabase
        let supabase = null;
        
        function initSupabase() {
            const supabaseUrl = 'https://ygjdvufbiobntseveoia.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlnamR2dWZiaW9ibnRzZXZlb2lhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzNzA3MTgsImV4cCI6MjA3MTk0NjcxOH0.BQGNl13CD_SkpBAkQ4ByiQilfAW-Wj7XpVzin2UNBls';
            
            try {
                supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
                return true;
            } catch (error) {
                console.error('Failed to initialize Supabase:', error);
                return false;
            }
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            navigator.clipboard.writeText(text).then(() => {
                const btn = element.nextElementSibling;
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.style.background = '#4caf50';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#666';
                }, 2000);
            });
        }

        function showStatus(elementId, type, message) {
            const element = document.getElementById(elementId);
            element.className = `status ${type}`;
            element.innerHTML = message;
        }

        function testEnvironment() {
            const checks = [
                { name: 'Hostname', value: window.location.hostname },
                { name: 'Origin', value: window.location.origin },
                { name: 'Protocol', value: window.location.protocol },
                { name: 'User Agent', value: navigator.userAgent.substring(0, 50) + '...' }
            ];

            let result = '<strong>Environment Check:</strong><br>';
            checks.forEach(check => {
                result += `${check.name}: ${check.value}<br>`;
            });

            const isProduction = window.location.hostname !== 'localhost';
            result += `<br><strong>Environment: ${isProduction ? 'Production ‚úÖ' : 'Development ‚ö†Ô∏è'}</strong>`;

            showStatus('env-status', isProduction ? 'success' : 'warning', result);
        }

        async function testSupabase() {
            if (!initSupabase()) {
                showStatus('supabase-status', 'error', 'Failed to initialize Supabase client');
                return;
            }

            try {
                showStatus('supabase-status', 'info', 'Testing Supabase connection...');
                
                const { data, error } = await supabase.auth.getSession();
                
                if (error) {
                    showStatus('supabase-status', 'error', `Supabase Error: ${error.message}`);
                } else {
                    showStatus('supabase-status', 'success', 
                        `Supabase Connected ‚úÖ<br>Session: ${data.session ? 'Active' : 'None'}`);
                }
            } catch (error) {
                showStatus('supabase-status', 'error', `Connection Failed: ${error.message}`);
            }
        }

        async function testOAuth() {
            if (!initSupabase()) {
                showStatus('oauth-status', 'error', 'Failed to initialize Supabase client');
                return;
            }

            try {
                showStatus('oauth-status', 'info', 'Testing OAuth configuration...');
                
                const { error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: window.location.origin + '/auth/callback',
                        queryParams: {
                            access_type: 'offline',
                            prompt: 'consent',
                        },
                    },
                });

                if (error) {
                    showStatus('oauth-status', 'error', `OAuth Error: ${error.message}`);
                } else {
                    showStatus('oauth-status', 'info', 'OAuth initiated - redirecting to Google...');
                }
            } catch (error) {
                showStatus('oauth-status', 'error', `OAuth Failed: ${error.message}`);
            }
        }

        async function getOAuthURL() {
            if (!initSupabase()) {
                showStatus('oauth-status', 'error', 'Failed to initialize Supabase client');
                return;
            }

            try {
                const { data, error } = await supabase.auth.getOAuthSignInUrl({
                    provider: 'google',
                    options: {
                        redirectTo: window.location.origin + '/auth/callback'
                    }
                });

                if (error) {
                    showStatus('oauth-status', 'error', `Failed to get OAuth URL: ${error.message}`);
                } else {
                    showStatus('oauth-status', 'success', 
                        `OAuth URL Generated ‚úÖ<br><a href="${data.url}" target="_blank" style="color: #4caf50;">Click to test OAuth</a>`);
                }
            } catch (error) {
                showStatus('oauth-status', 'error', `OAuth URL Error: ${error.message}`);
            }
        }

        function showDebugInfo() {
            const debugInfo = {
                timestamp: new Date().toISOString(),
                location: {
                    href: window.location.href,
                    origin: window.location.origin,
                    hostname: window.location.hostname,
                    protocol: window.location.protocol,
                    port: window.location.port || 'default'
                },
                expectedUrls: {
                    googleJsOrigins: [
                        window.location.origin,
                        'https://ygjdvufbiobntseveoia.supabase.co'
                    ],
                    googleRedirectUris: [
                        'https://ygjdvufbiobntseveoia.supabase.co/auth/v1/callback'
                    ],
                    supabaseSiteUrl: window.location.origin,
                    supabaseRedirectUrls: [
                        window.location.origin + '/auth/callback'
                    ]
                },
                environment: {
                    isProduction: window.location.hostname !== 'localhost',
                    userAgent: navigator.userAgent
                }
            };

            document.getElementById('debug-info').textContent = JSON.stringify(debugInfo, null, 2);
        }

        // Auto-run environment test on load
        window.addEventListener('load', () => {
            testEnvironment();
            showDebugInfo();
        });
    </script>
</body>
</html>
